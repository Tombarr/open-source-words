localstack a fully functional local aws cloud stack localstack provides an easy to use test mocking framework for developing cloud applications currently the focus is primarily on supporting the aws cloud stack announcements 2018 01 10 help wanted please fill out this survey to support a research study on the usage of serverless and function as a service faas services conducted at chalmers university of technology the survey only takes 5 10 minutes of your time many thanks for your participation 2017 08 27 we need your support localstack is growing fast we now have thousands of developers using the platform on a regular basis last month we have recorded a staggering 100k test runs with 25k dynamodb tables 20k sqs queues 15k kinesis streams 13k s3 buckets and 10k lambda functions created locally for 0 costs more details to be published soon bug and feature requests are pouring in and we now need some support from you to keep the open source version actively maintained please check out open collective and become a backer or supporter of the project today thanks everybody for contributing ‚ô• 2017 07 20 please note starting with version 0 7 0 the docker image will be pushed and kept up to date under the new name localstack localstack this means that you may have to update your ci configurations please refer to the updated end user license agreement eula for the new versions the old docker image atlassianlabs localstack is still available but will not be maintained any longer overview localstack spins up the following core cloud apis on your local machine api gateway at http localhost 4567 kinesis at http localhost 4568 dynamodb at http localhost 4569 dynamodb streams at http localhost 4570 elasticsearch at http localhost 4571 s3 at http localhost 4572 firehose at http localhost 4573 lambda at http localhost 4574 sns at http localhost 4575 sqs at http localhost 4576 redshift at http localhost 4577 es elasticsearch service at http localhost 4578 ses at http localhost 4579 route53 at http localhost 4580 cloudformation at http localhost 4581 cloudwatch at http localhost 4582 ssm at http localhost 4583 additionally localstack provides a powerful set of tools to interact with the cloud services including a fully featured kcl kinesis client with python binding simple setup teardown integration for nosetests as well as an environment abstraction that allows to easily switch between local and remote cloud execution why localstack localstack builds on existing best of breed mocking testing tools most notably kinesalite dynalite and moto while these tools are awesome they lack functionality for certain use cases localstack combines the tools makes them interoperable and adds important missing functionality on top of them error injection localstack allows to inject errors frequently occurring in real cloud environments for instance provisionedthroughputexceededexception which is thrown by kinesis or dynamodb if the amount of read write throughput is exceeded actual http rest services all services in localstack allow actual http connections on a tcp port in contrast moto uses boto client proxies that are injected into all methods annotated with mock sqs these client proxies do not perform an actual rest call but rather call a local mock service method that lives in the same process as the test code language agnostic although localstack is written in python it works well with arbitrary programming languages and environments due to the fact that we are using the actual rest apis via http isolated processes all services in localstack run in separate processes the overhead of additional processes is negligible and the entire stack can easily be executed on any developer machine and ci server in moto components are often hard wired in ram e g when forwarding a message on an sns topic to an sqs queue the queue endpoint is looked up in a local hash map in contrast localstack services live in isolation separate processes available via http which fosters true decoupling and more closely resembles the real cloud environment pluggable services all services in localstack are easily pluggable and replaceable due to the fact that we are using isolated processes for each service this allows us to keep the framework up to date and select best of breed mocks for each individual service requirements make python both python 2 x and 3 x supported pip python package manager npm node js package manager java javac java 8 runtime environment and compiler mvn maven the build system for java installing the easiest way to install localstack is via pip pip install localstack once installed run the infrastructure using the following command localstack start note please do not use sudo or the root user localstack should be installed and started entirely under a local non root user if you have problems with permissions in macos x sierra install with pip install user localstack running in docker you can also spin up localstack in docker localstack start docker note that on macos you may have to run tmpdir private tmpdir localstack start docker if tmpdir contains a symbolic link that cannot be mounted by docker or using docker compose you need to clone the repository first docker compose up note that on macos you may have to run tmpdir private tmpdir docker compose up if tmpdir contains a symbolic link that cannot be mounted by docker configurations you can pass the following environment variables to localstack services comma separated list of service names and optional ports they should run on if no port is specified a default port is used service names basically correspond to the service names of the aws cli kinesis lambda sqs etc although localstack only supports a subset of them example value kinesis lambda 4569 sqs 4570 to start kinesis on the default port lambda on port 4569 and sqs on port 4570 default region aws region to use when talking to the api defaults to us east 1 hostname name of the host to expose the services internally defaults to localhost use this to customize the framework internal communication e g if services are started in different containers using docker compose hostname external name of the host to expose the services externally defaults to localhost this host is used e g when returning queue urls from the sqs service to the client use ssl whether to use https urls with ssl encryption defaults to false kinesis error probability decimal value between 0 0 default and 1 0 to randomly inject provisionedthroughputexceededexception errors into kinesis api responses dynamodb error probability decimal value between 0 0 default and 1 0 to randomly inject provisionedthroughputexceededexception errors into dynamodb api responses lambda executor method to use for executing lambda functions possible values are local run lambda functions in a temporary directory on the local machine docker run each function invocation in a separate docker container docker reuse create one docker container per function and reuse it across invocations for docker and docker reuse if localstack itself is started inside docker then the docker command needs to be available inside the container usually requires to run the container in privileged mode default is docker fallback to local if docker is not available lambda remote docker determines whether lambda code is copied or mounted into containers possible values are true default your lambda function definitions will be passed to the container by copying the zip file potentially slower it allows for remote execution where the host and the client are not on the same machine false your lambda function definitions will be passed to the container by mounting a volume potentially faster this requires to have the docker client and the docker host on the same machine data dir local directory for saving persistent data currently only supported for these services kinesis dynamodb elasticsearch s3 set it to tmp localstack data to enable persistence tmp localstack is mounted into the docker container leave blank to disable persistence default port web ui port for the web user interface dashboard default is 8080 service backend custom endpoint url to use for a specific service where service is the uppercase service name currently works for apigateway cloudformation dynamodb elasticsearch kinesis s3 sns sqs this allows to easily integrate third party services into localstack force noninteractive when running with docker disables the interactive and tty flags useful when running headless additionally the following read only environment variables are available localstack hostname name of the host where localstack services are available this is needed in order to access the services from within your lambda functions e g to store an item to dynamodb or s3 from lambda the variable localstack hostname is available for both local lambda execution lambda executor local and execution inside separate docker containers lambda executor docker accessing the infrastructure via cli or code you can point your aws cli to use the local infrastructure for example aws endpoint url http localhost 4568 kinesis list streams streamnames new check out awslocal a thin cli wrapper that runs commands directly against localstack no need to specify endpoint url anymore install it via pip install awscli local and then use it as follows awslocal kinesis list streams streamnames update use the environment variable localstack hostname to determine the target host inside your lambda function see configurations section for more details client libraries python https github com localstack localstack python client alternatively you can also use boto3 and use the endpoint url parameter when creating a connection more coming soon integration with nosetests if you want to use localstack in your integration tests e g nosetests simply fire up the infrastructure in your test setup method and then clean up everything in your teardown method from localstack services import infra def setup infra start infra async true def teardown infra stop infra def my app test here goes your test logic see the example test file tests test integration py for more details integration with java junit in order to use localstack with java the project ships with a simple junit runner and a junit 5 extension take a look at the example junit test in ext java when you run the test all dependencies are automatically downloaded and installed to a temporary directory in your system import cloud localstack localstacktestrunner import cloud localstack testutils runwith localstacktestrunner class public class mycloudapptest test public void testlocals3api amazons3 s3 testutils getclients3 list buckets s3 listbuckets or with junit 5 extendwith localstackextension class public class mycloudapptest additionally there is a version of the localstack test runner which runs in a docker container instead of installing localstack on the current machine the only dependency is to have docker installed locally the test runner will automatically pull the image and start the container for the duration of the test the container can be configured by using the localstackdockerproperties annotation runwith localstackdockertestrunner class localstackdockerproperties randomizeports true services sqs kinesis 77077 public class mydockercloudapptest test public void testkinesis amazonkinesis kinesis dockertestutils getclientkinesis liststreamsresult streams kinesis liststreams or with junit 5 extendwith localstackdockerextension class localstackdockerproperties randomizeports true services sqs kinesis 77077 public class mydockercloudapptest the localstack junit test runner is published as an artifact in maven central simply add the following dependency to your pom xml file dependency groupid cloud localstack groupid artifactid localstack utils artifactid version 0 1 14 version dependency troubleshooting if youre using aws java libraries with kinesis please refer to cbor protocol issues with the java sdk guide how to disable cbor protocol which is not supported by kinesalite accessing local s3 from java to avoid domain name resolution issues you need to enable path style access on your client s3 sets3clientoptions s3clientoptions builder setpathstyleaccess true build there is also an option to do this if youre using any of the client builder classes amazons3clientbuilder builder amazons3clientbuilder standard builder withpathstyleaccessenabled true mounting the temp directory note that on macos you may have to run tmpdir private tmpdir docker compose up if tmpdir contains a symbolic link that cannot be mounted by docker see details here https bitbucket org atlassian localstack issues 40 getting mounts failed on docker compose up if you run into file permission issues on pip install under mac os e g permission denied library python 2 7 site packages six py then you may have to re install pip via homebrew see this discussion thread alternatively try installing with the user flag pip install user localstack if you are deploying within openshift please be aware the pod must run as root and the user must have capabilities added to the running pod in order to allow elasticsearch to be run as the non root localstack user the environment variable no proxy is rewritten by localstack internal requests will go straight via localhost bypassing any proxy configuration developing if you pull the repo in order to extend modify localstack run this command to install all the dependencies make install this will install the required pip dependencies in a local python virtualenv directory venv your global python packages will remain untouched as well as some node modules in localstack node modules depending on your system some pip npm modules may require additional native libs installed the makefile contains a target to conveniently run the local infrastructure for development make infra check out the developer guide which contains a few instructions on how to get started with developing and debugging features for localstack testing the project contains a set of unit and integration tests that can be kicked off via a make target make test web dashboard the projects also comes with a simple web dashboard that allows to view the deployed aws components and the relationship between them localstack web change log v0 8 7 support net core 2 0 and nodejs8 10 lambdas refactor java libs and integrate with junit 5 support tags for es domains add cloudformation support for sns topics fix kinesis error injection fix override of es java opts fix sqs cors preflight response fix s3 content md5 checks and host header fix es startup issue bump elasticmq to 0 13 10 bump kinesalite version v0 8 6 fixes for windows installation bump es to 6 2 0 support filter policy for sns upgrade kinesalite refactor junit runner support lambda putfunctionconcurrency and geteventsourcemapping fixes for terraform add golang support to lambda fix file permission issue in java lambda tests fix s3 bucket notification config v0 8 5 fix ddb streams event type implement cf fn getazs async lambda for ddb events fix s3 content type fix cf deployer for sqs fix s3 exposeports fix message subject in sns support for firehose es pass external env vars to containers from java add mock for list queue tags enhance docker test runner fix windows installation issues new version of java libs v0 8 4 fix pipenv dependency issue docker junit test runner pojo type for java lambda requesthandler java lambda dynamodb event reuse docker containers for lambda invocations api gateway wildcard path segments fix sns rawmessagedelivery v0 8 3 fix ddb stream events for update operations fix ddb streams sequence numbers fix transfer encoding for ddb fix requests with missing content length header support non ascii content in dynamodb items map external port for sqs queue urls default to lambda remote docker true if running in docker s3 lifecycle support reduce docker image size v0 8 2 fix s3 bucket notification configuration cors headers for api gateway fix 128k s3 multipart uploads return valid shardids in dynamodb streams fix hardcoded ddblocal dynamodb tablearn import default service ports from localstack client fix s3 bucket policy response execute lambdas asynchronously if the source is a topic v0 8 1 improvements in lambda api publish version list version function aliases use single map with lambda function details workaround for sqs fifo queues add test for s3 upload initial support for ssm fix regex to replace sqs queue url hostnames update linter single quotes use docker for mac localhost to connect to localstack from docker on mac fix b64 encoding for java lambdas fix path of moto server command v0 8 0 fix request data in genericproxyhandler add port web ui and hostname external configs api gateway path parameters enable flake8 linting add config for service backend urls use elasticmq instead of moto for sqs expose localstack hostname custom environment variable support for lambda improve error logging and installation for java junit add support for s3 rest object post v0 7 5 fix issue with incomplete parallel downloads bypass http proxy for internal requests use native python code to unzip archives download kcl client libs only for testing and not on pip install v0 7 4 refactor cli and enable plugins support unicode names for s3 fix sqs names containing a dot character execute java lambda functions in docker containers fix dynamodb error handling update docs v0 7 3 extract proxy listeners into sub classes put java libs into a single fat jar fix issue with non daemonized threads refactor code to start flask services v0 7 2 fix data dir config when running in docker fix maven dependencies return consumedcapacity from dynamodb get item use queue arn instead of url for s3 bucket notifications v0 7 1 fix s3 api to get bucket notifications release java artifacts to maven central fix s3 file access from spark create ddb stream on updatetable remove aui dependency optimize size of docker image v0 7 0 support for kinesis in cloudformation extend and integrate java tests in ci publish docker image under new name update readmes and license agreements v0 6 2 major refactoring of installation process lazy loading of dependencies v0 6 1 add cors headers platform compatibility fixes remove shell commands and sh module add cloudformation validate template fix lambda execution in docker basic domain handling in es api api gateway authorizers v0 6 0 load services as plugins fix service default ports fix sqs sns and md5 of message attributes fix host header for s3 v0 5 5 enable ssl encryption for all service endpoints use ssl config create docker base image fix issue with data dir v0 5 4 remove hardcoded tmp for windows compat update cli and docs fix s3 sns notifications disable elasticsearch compression v0 5 3 add cloudformation support for serverless api gateway deployments fix installation via pypi minor fix for java passing of environment variables v0 5 0 extend dynamodb streams api fix keep alive connection for s3 fix deadlock in nested lambda executions add integration sns lambda cloudformation serverless example replace dynalite with dynamodblocal support lambda execution in remote docker container fix cloudwatch metrics for lambda invocation errors v0 4 3 initial support for cloudwatch metrics for lambda functions http forwards for api gateway fix s3 message body signatures download lambda archive from s3 bucket fix extend es tests v0 4 2 initial support for java lambda functions cloudformation deployments api gateway tests v0 4 1 python 3 compatibility data persistence add seq numbers in kinesis events limit elasticsearch memory v0 4 0 execute lambda functions in docker containers cors headers for s3 v0 3 11 add route53 ses cloudformation dynamodb fault injection ui tweaks refactor config v0 3 10 add initial support for s3 bucket notifications fix subprocess32 installation v0 3 9 make services ports configurable via services add tests for firehose s3 v0 3 8 fix elasticsearch via local bind and proxy refactoring improve error logging v0 3 5 fix lambda handler name fix host name for s3 api install web libs on pip install v0 3 4 fix file permissions in build fix and add ui to docker image add stub of es api v0 3 3 add version tags to docker images v0 3 2 add support for redshift api code refactoring v0 3 1 add dockerfile and push image to docker hub v0 3 0 add simple integration for junit improve process signal handling v0 2 11 refactored the aws assume role function v0 2 10 added aws assume role functionality v0 2 9 kinesis error response formatting v0 2 7 throw kinesis errors randomly v0 2 6 decouple sns sqs intercept sns calls and forward to subscribed sqs queues v0 2 5 return error response from kinesis if flag is set v0 2 4 allow lambdas to use file import from file instead of execing v0 2 3 improve kinesis kcl auto checkpointing leases in ddb v0 2 0 speed up installation time by lazy loading libraries v0 1 19 pass shard id in records sent from kcl process v0 1 16 minor restructuring and refactoring create separate kinesis util py v0 1 14 fix aws tokens when creating elasticsearch client v0 1 11 add startup initialization notification for kcl process v0 1 10 bump version of amazon kclpy to 1 4 1 v0 1 9 add initial support for sqs sns v0 1 8 fix installation of jars in amazon kclpy if localstack is installed transitively v0 1 7 bump version of amazon kclpy to 1 4 0 v0 1 6 add travis ci and coveralls configuration v0 1 5 refactor elasticsearch utils fix bug in method to delete all es indexes v0 1 4 enhance logging extend java kcl credentials provider support sts assumed roles v0 1 2 add configurable kcl log output v0 1 0 initial release contributing we welcome feedback bug reports and pull requests for pull requests please stick to the following guidelines add tests for any new features and bug fixes ideally each pr should increase the test coverage follow the existing code style e g indents a pep8 code linting target is included in the makefile put a reasonable amount of comments into the code separate unrelated changes into multiple pull requests 1 commit per pr please squash rebase multiple commits into one single commit to keep the history clean please note that by contributing any code or documentation to this repository by raising pull requests or otherwise you explicitly agree to the contributor license agreement contributors this project exists thanks to all the people who contribute backers thank you to all our backers üôè become a backer sponsors support this project by becoming a sponsor your logo will show up here with a link to your website become a sponsor license copyright c 2017 localstack maintainers and contributors copyright c 2016 atlassian and others this version of localstack is released under the apache license version 2 0 see license txt by downloading and using this software you agree to the end user license agreement eula we build on a number of third party software tools with the following licenses third party software license python pip modules airspeed bsd license amazon kclpy amazon software license boto3 apache license 2 0 coverage apache license 2 0 docopt mit license elasticsearch apache license 2 0 flask bsd license flask swagger mit license jsonpath rw apache license 2 0 moto apache license 2 0 nose gnu lgpl pep8 expat license requests apache license 2 0 subprocess32 psf license node js npm modules kinesalite mit license other tools elasticsearch apache license 2 0